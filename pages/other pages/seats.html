<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticket Booking</title>
    <link rel="stylesheet" href="../../assets/css/seats.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
     
</head>

<body>
    <div class="opac">
    <div class="movie-container">
        <label> movie</label>
        <select id="movie">
            <option class="Pathu thala"value="100">Pathu thala</option>
        </select>
    </div>

    <ul class="showcase">
        <li>
            <div class="seat"></div>
            <small>Available</small>
        </li>
        <li>
            <div class="seat selected"></div>
            <small>Selected</small>
        </li>
        <li>
            <div class="seat occupied"></div>
            <small>Occupied</small>
        </li>
    </ul>

    <div class="container">
        <div class="screen"></div>
        <div class="row">
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>


        </div>
        <div class="row">
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>


        </div>
        <div class="row">
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>


        </div>
        <div class="row">
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>


        </div>
        <div class="row">
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>

        </div>



        <div class="row">
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat "></div>
            <div class="seat "></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>


        </div>


        <div class="row">
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>


        </div>

        <div class="row">
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat "></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>
            <div class="seat"></div>


        </div>


    </div>

    <p class="text">
        you have selected <span id="count">0</span> seats for a price of Rs <span id="total">0</span>
    </p>

    <div>
      
        <a href="./bookdetails.html"><button class="proceed" onclick="onTicket()">Proceed</button></a>
    </div>

    <!-- <section class="footer">
        <div class="box-container">
            <div class="box">
                <h3>Quick links</h3>
                <a href="./index.html">
                    <i class="fas fa-chevron-right"></i> Home 
                </a>
                <a href="/pages/other pages/Trailer.html">
                    <i class="fas fa-chevron-right"></i> Trailers 
                </a>
                <a href="/pages/other pages/about.html">
                    <i class="fas fa-chevron-right"></i> About us 
                </a>
                <a href="/pages/other pages/Theatres.html">
                    <i class="fas fa-chevron-right"></i> Cinemas 
                </a>    
            </div>
            <div class="box">
                <h3>contact info</h3>
                <a href="#">
                    <i class="fas fa-phone"></i> +91-8939470586 
                </a>
                <a href="#">
                    <i class="fas fa-envelope"></i> mohammedirfan.rahamathulla@fssa.freshworks.com 
                </a>
                <a href="#">
                    <i class="fas fa-map-marker-alt"></i> Chennai-603202 
                </a>
            </div>
            <div class="box">
                <h3>follow us</h3>
                <a href="https://www.facebook.com/profile.php?id=100053565876863&mibextid=ZbWKwL">
                    <i class="fab fa-facebook-f"></i> facebook 
                </a>
                <a href="https://twitter.com/Mohammed_Irfu?s=09">
                    <i class="fab fa-twitter"></i> twitter 
                </a>
                <a href="https://instagram.com/irfan_swagz?igshid=ZDdkNTZiNTM=">
                    <i class="fab fa-instagram"></i> instagram 
                </a>
                <a href="https://www.linkedin.com/in/mohammedirfan-rahamathulla-26b796264">
                    <i class="fab fa-linkedin"></i> linkedin 
                </a>
            </div>
        </div>
        <div class="credit">
            Created by <span> Mr. Irfu</span> | All Rights Reserved 
        </div>
    </section> -->

    </div>


<script src="./js/header.js"></script>
    <script>

const url = window.location.search;
console.log(url);
const urlParams = new URLSearchParams(url);
console.log(urlParams);
const showtime = urlParams.get("show");
console.log(showtime);
localStorage.setItem("showtime",JSON.stringify(showtime))

const container = document.querySelector('.container');
const seats = document.querySelectorAll('.row .seat:not(.occupied)');
const count = document.getElementById('count');
const total = document.getElementById('total');
const movieSelect = document.getElementById('movie');

let ticketPrice = +movieSelect.value;


onPageLoad();

// onpagload function

function onPageLoad() {
    let seatIndex = JSON.parse(localStorage.getItem('SelectedSeatsIndex'));
    if (seatIndex !== null) {
        seats.forEach((seat, index) => {
            if (seatIndex.indexOf(index) > -1) {
                seat.classList.add('selected')

            }
        })
    }
    let movieIndex = localStorage.getItem('seletedMovieIndex');
    if (movieIndex !== null) {
        movieSelect.selectedIndex = movieIndex;
    }


}

// seave selected movie index and price

function setMovieData(movieIndex, moviePrice) {

    let seatObj = {
        movieIndex,
        moviePrice,
    }
    console.error(seatObj);
    localStorage.setItem('seletedMovieIndex', JSON.stringify(seatObj));
    // localStorage.setItem('selectedMoviePrice', (moviePrice));

}

// update total and count 

function updateSelectedCount() {
    const selectedSeats = document.querySelectorAll('.row .seat.selected');
    const selectedSeatsCount = selectedSeats.length
    count.innerHTML = selectedSeatsCount;
    total.innerHTML = selectedSeatsCount * ticketPrice;
    let seatIndex = [...selectedSeats].map(function (seat) {
        return [...seats].indexOf(seat);
    })
    localStorage.setItem('SelectedSeatsIndex', JSON.stringify(seatIndex));
    localStorage.setItem('SelectedSeatsTotalPrice', (total.innerHTML));

    console.log("seatIndex",seatIndex);


}

movieSelect.addEventListener('change', (e) => {
    ticketPrice = +e.target.value;
    updateSelectedCount()
    setMovieData(e.target.selectedIndex, e.target.value)

    
})
container.addEventListener('click', (e) => {
    if (e.target.classList.contains('seat') && !e.target.classList.contains('occupied')) {
        e.target.classList.toggle('selected')
    }

    updateSelectedCount()
})

updateSelectedCount();


///////// seats Proceed--------------------------------------------------------------/////////////////


// $(document).ready(function () {
//     $('.show').click(function () {
//         $('.bookBg').hide(500);
//         $('.screen').show();

//     })
// })

function onTicket() {

    const select = document.getElementById("movie");
    console.log(select);
// Get the selected option
const option = select.options[select.selectedIndex];
// Get the movie name
const movieName = option.text;
// Print the movie name
console.log(movieName);


    let noseat = JSON.parse(localStorage.getItem('SelectedSeatsIndex'));
    console.log(noseat);
    let ar =[];
    ar.push(noseat)
    let seatPrice = localStorage.getItem('SelectedSeatsTotalPrice');
console.log(seatPrice);
    let innerSeat = document.getElementsById("count");
    console.log(innerSeat);
    let innerPrice = document.getElementsById('total');
console.log(innerPrice);
    innerSeat.innerHTML = ar.length;
    innerPrice.innerHTML = seatPrice;

  

    bookTicket();

}


let theatreName = JSON.parse(window.localStorage.getItem("theatreName"));
let SelectedSeatsIndex = JSON.parse(window.localStorage.getItem("SelectedSeatsIndex"));
let showtiming = JSON.parse(window.localStorage.getItem("showtime"));
let  movieid = JSON.parse(window.localStorage.getItem("movieid"));
let selectedSeatsTotalPrice = JSON.parse(window.localStorage.getItem("SelectedSeatsTotalPrice"));
let uniq_id = window.localStorage.getItem("unique_id");   



let bookedticket = {
    theatreName,
    SelectedSeatsIndex,
    showtiming,
    movieid,
    selectedSeatsTotalPrice,
    uniq_id,
 }
 let bookeddetails = [];

 bookeddetails.push(bookedticket);
 localStorage.setItem("bookeddetails",JSON.stringify(bookeddetails));




    </script>
 
</body>

</html>