<!DOCTYPE html>
movie_payments.html>

<head lan="eng">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Movie Seats</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="../../assets/css/seatt.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
</head>

<body>

    <!-- header logo -->

    <!-- movie banner -->
    <div class="banner">

    </div>

    <!-- screen text -->
    <div class="screen">
        
        <h3>Screen on this way</h3>
    </div>

    <div class="seat_disclaimer">

        <div class="show-case">
            <p class="seat-prime selected"></p>
            <label style="color: white;">SEAT SELECTED</label>
        </div>

        <div class="show-case">
            <p class="seat-prime"></p>
            <label style="color: white;">SEAT AVAILABLE</label>
        </div>

        <div class="show-case">
            <p class="seat-prime occupied" style="color:black; background-color:#535353"></p>
            <label style="color: white;">SEAT BOOKED</label>
        </div>

    </div>

    <div class="seatcost-budget">

        <select id="movie">
            <option value="130"> Rs.130</option>
        </select>

        <h2>First class(Rs130)</h2>

    </div>

    <div id="container">
        <div class="seat" data-name="A1">A1</div>
        <div class="seat" data-name="A2">A2</div>
        <div class="seat" data-name="A3">A3</div>
        <div class="seat" data-name="A4">A4</div>
        <div class="seat" data-name="A5">A5</div>
        <div class="seat" data-name="A6">A6</div>
        <div class="seat" data-name="A7">A7</div>
        <div class="seat" data-name="A8">A8</div>
        <div class="seat" data-name="A9">A9</div>
        <div class="seat" data-name="A10">A10</div>
        <div class="seat" data-name="A11">A11</div>
        <div class="seat" data-name="A12">A12</div>
        <div class="seat" data-name="A13">A13</div>
        <div class="seat" data-name="A14">A14</div>
        <div class="seat" data-name="A15">A15</div>
    </div>

    <div id="container">

        <div class="seat" data-name="B1">B1</div>
        <div class="seat" data-name="B2">B2</div>
        <div class="seat" data-name="B3">B3</div>
        <div class="seat" data-name="B4">B4</div>
        <div class="seat" data-name="B5">B5</div>
        <div class="seat" data-name="B6">B6</div>
        <div class="seat" data-name="B7">B7</div>
        <div class="seat" data-name="B8">B8</div>
        <div class="seat" data-name="B9">B9</div>
        <div class="seat" data-name="B10">B10</div>
        <div class="seat" data-name="B11">B11</div>
        <div class="seat" data-name="B12">B12</div>
        <div class="seat" data-name="B13">B13</div>
        <div class="seat" data-name="B14">B14</div>
        <div class="seat" data-name="B15">B15</div>
    </div>

    <div id="container">
        <div class="seat" data-name="C1">C1</div>
        <div class="seat" data-name="C2">C2</div>
        <div class="seat" data-name="C3">C3</div>
        <div class="seat" data-name="C4">C4</div>
        <div class="seat" data-name="C5">C5</div>
        <div class="seat" data-name="C6">C6</div>
        <div class="seat" data-name="C7">C7</div>
        <div class="seat" data-name="C8">C8</div>
        <div class="seat" data-name="C9">C9</div>
        <div class="seat" data-name="C10">C10</div>
        <div class="seat" data-name="C11">C11</div>
        <div class="seat" data-name="C12">C12</div>
        <div class="seat" data-name="C13">C13</div>
        <div class="seat" data-name="C14">C14</div>
        <div class="seat" data-name="C15">C15</div>
    </div>

    <div id="container">

        <div class="seat" data-name="D1">D1</div>
        <div class="seat" data-name="D2">D2</div>
        <div class="seat" data-name="D3">D3</div>
        <div class="seat" data-name="D4">D4</div>
        <div class="seat" data-name="D5">D5</div>
        <div class="seat" data-name="D6">D6</div>
        <div class="seat" data-name="D7">D7</div>
        <div class="seat" data-name="D8">D8</div>
        <div class="seat" data-name="D9">D9</div>
        <div class="seat" data-name="D10">D10</div>
        <div class="seat" data-name="D11">D11</div>
        <div class="seat" data-name="D12">D12</div>
        <div class="seat" data-name="D13">D13</div>
        <div class="seat" data-name="D14">D14</div>
        <div class="seat" data-name="D15">D15</div>
    </div>

    <div id="container">
        <div class="seat" data-name="E1">E1</div>
        <div class="seat" data-name="E2">E2</div>
        <div class="seat" data-name="E3">E3</div>
        <div class="seat" data-name="E4">E4</div>
        <div class="seat" data-name="E5">E5</div>
        <div class="seat" data-name="E6">E6</div>
        <div class="seat" data-name="E7">E7</div>
        <div class="seat" data-name="E8">E8</div>
        <div class="seat" data-name="E9">E9</div>
        <div class="seat" data-name="E10">E10</div>
        <div class="seat" data-name="E11">E11</div>
        <div class="seat" data-name="E12">E12</div>
        <div class="seat" data-name="E13">E13</div>
        <div class="seat" data-name="E14">E14</div>
        <div class="seat" data-name="E15">E15</div>
    </div>

    <div id="container">

        <div class="seat" data-name="F1">F1</div>
        <div class="seat" data-name="F2">F2</div>
        <div class="seat" data-name="F3">F3</div>
        <div class="seat" data-name="F4">F4</div>
        <div class="seat" data-name="F5">F5</div>
        <div class="seat" data-name="F6">F6</div>
        <div class="seat" data-name="F7">F7</div>
        <div class="seat" data-name="F8">F8</div>
        <div class="seat" data-name="F9">F9</div>
        <div class="seat" data-name="F10">F10</div>
        <div class="seat" data-name="F11">F11</div>
        <div class="seat" data-name="F12">F12</div>
        <div class="seat" data-name="F13">F13</div>
        <div class="seat" data-name="F14">F14</div>
        <div class="seat" data-name="F15">F15</div>
    </div>

    <div id="container">
        <div class="seat" data-name="G1">G1</div>
        <div class="seat" data-name="G2">G2</div>
        <div class="seat" data-name="G3">G3</div>
        <div class="seat" data-name="G4">G4</div>
        <div class="seat" data-name="G5">G5</div>
        <div class="seat" data-name="G6">G6</div>
        <div class="seat" data-name="G7">G7</div>
        <div class="seat" data-name="G8">G8</div>
        <div class="seat" data-name="G9">G9</div>
        <div class="seat" data-name="G10">G10</div>
        <div class="seat" data-name="G11">G11</div>
        <div class="seat" data-name="G12">G12</div>
        <div class="seat" data-name="G13">G13</div>
        <div class="seat" data-name="G14">G14</div>
        <div class="seat" data-name="G15">G15</div>
    </div>

    <div class="whole-theatre-details">
        <div class="total_seatandcost">

            <div class="seat_total">
                    <h3 style="font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;">SEAT DETAILS</h3>
                <p id="selected-seats" style="color: black; "></p>
            </div>

            <div class="theatre_details">
                <h3 id="theater_name" style="color:black"></h3>
                <div class="date">
                    <span id="show_time" style="color:black"></span>
                    <span id="show_date" style="color:black;font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;font-size: 23px;"></span>
                    <span id="show_day" style="color:black;font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;font-size: 23px;"></span>
                    <span id="show_month" style="color:black;font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;font-size: 23px;"></span>
                </div>

            </div>

            <div class="cost_total">
                <h3>TOTAL PRICE</h3>
                <span id="total">0</span>
            </div>
        </div>

        <p id="seat-length" style="display: none;"></p>

        <img onclick="bookSeats()" id="next-arrow" src="https://i.ibb.co/wSgdWYq/right-arrow.png" alt="logo">

    </div>

     <script>
        const movie_list = JSON.parse(localStorage.getItem("show_movie_details"))

        const url = window.location.search;                
        const urlParams = new URLSearchParams(url);    
        const username = urlParams.get("name")         
        console.log(username);

        let res;
        movie_list.find((e) => {
            if (e.name.movie_name == username) { 
                return res = e;
            }

            return res = 0;

        });

        const banner = document.querySelector(".banner");
        banner.style.backgroundImage = res.images.background_image;

        const movie_name = document.createElement("h1");
        movie_name.innerText = res.name.movie_name;
        banner.append(movie_name);

        const users_booking = JSON.parse(localStorage.getItem("user_booking"));

        const theater_name = document.getElementById("theater_name");
        theater_name.innerHTML = users_booking[0].theatre_name;

        const show_time = document.getElementById("show_time");
        show_time.innerHTML = users_booking[0].show_time;

        const show_date = document.getElementById("show_date");
        show_date.innerHTML = users_booking[0].show_date

        const show_day = document.getElementById("show_day");
        show_day.innerHTML = users_booking[0].show_day

        const show_month = document.getElementById("show_month");
        show_month.innerHTML = users_booking[0].show_month

        const container = document.querySelectorAll("#container");
        const selectedSeatsList = document.getElementById("selected-seats");
        const total = document.getElementById("total");
        const ticketprice = document.getElementById("movie").value;
        let selectedSeats = [];

        const seats = document.querySelectorAll(".seat");

        let booking_history = JSON.parse(localStorage.getItem("booking_history"));


       let seatss= seats.forEach((el) => {

            for (i = 0; i < booking_history.length; i++) {

                let seat = booking_history[i].seat_name.split(",");

    
                if (movie_name == res.name.movie_name && theater_name == booking_history[i].theatre_name && show_time == booking_history[i].show_time && show_date == booking_history[i].show_date && show_day == booking_history[i].show_day && show_month == booking_history.show_month) {
                }
            }

        })

        seats.forEach(seat => {
            seat.addEventListener("click", () => {
                if (seat.classList.contains("selected")) {
                    seat.classList.remove("selected");
                    selectedSeats = selectedSeats.filter(name => name !== seat.dataset.name);
                } else {
                    seat.classList.add("selected");
                    selectedSeats.push(seat.dataset.name);
                }
                updateSelectedSeatsList();
            });

        });

        function updateSelectedSeatsList() {
            selectedSeatsList.innerHTML = "";
            selectedSeats.forEach(seat => {
                const listItem = document.createElement("p");
                listItem.setAttribute("id", "seat-select")
                listItem.textContent = seat;
                selectedSeatsList.appendChild(listItem);
            });

            const selectseatcount = document.getElementById("seat-length").innerText = selectedSeats.length;
            total.innerText = selectseatcount * ticketprice;

        }

        function generateRandomAlphabetString(length) {
            let result = '';
            let num = 0
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            const charactersLength = characters.length;
            for (let i = 0; i < 5; i++) {
                result += characters.charAt(Math.floor(Math.random() * charactersLength));
            }
            for (let j = 0; j < 1; j++) {
                num += Math.floor(Math.random() * 100)
            }

            return result + num;
        }
        const randomString = generateRandomAlphabetString();

        function bookSeats() {
            if (selectedSeats.length === 0) {
                swal("Please select at least one seat!");
            } else if (selectedSeats.length == 11) {
                alert(" You can select 10 seats only!");
            }
            else {

                window.location.href = `./movie_payment.html?name=${res.name.movie_name}`;

                const user_booking = JSON.parse(localStorage.getItem("user_booking")) ?? []
                if (JSON.parse(localStorage.getItem("user_booking"))) {
                    user_booking.find(e => {
                        if (e.email == e.email) {
                            e.seat_names = selectedSeats
                            e.booking_id = randomString
                            e.seat_count = selectedSeats.length
                            e.seat_price = total.innerText
                            localStorage.setItem("user_booking", JSON.stringify(user_booking))

                        }
                        else {
                            const booking_data = {
                                "email": users.booking,
                                "show_day": day,
                                "show_date": date,
                                "show_month": month,
                                "theatre_name": theatre_name,
                                "seat_names": selectedSeats,
                                "booking_id": randomString,
                                "seat_count": selectedSeats.length,
                                "seat_price": total.innerText,
                                "show_time": show_time,
                            }
                            user_booking.push(booking_data)

                            localStorage.setItem("user_booking", JSON.stringify(user_booking))
                        }
                    })
                }

                selectedSeats = [];

                seats.forEach(seat => seat.classList.remove("selected"));
                updateSelectedSeatsList();
            }
        }
    </script>

</body>

</html>